-- Adminer 4.2.2 MySQL dump

SET NAMES utf8;
SET time_zone = '+00:00';
SET foreign_key_checks = 0;
SET sql_mode = 'NO_AUTO_VALUE_ON_ZERO';

DELIMITER ;;

DROP FUNCTION IF EXISTS `forecast_avg_tomorrow`;;
CREATE FUNCTION `forecast_avg_tomorrow`() RETURNS varchar(128) CHARSET ascii
begin

set @min_id = (select min(id) from shots_master);
set @shots_number = (select count(*) from shots_master);
set @interval = (select (sum(TIMESTAMPDIFF(second, (select min(time) from shots_master), time)/(id - @min_id))/(60 * @shots_number)) from shots_master);
set @next_day_avg = '';

set @_sell_start = (select buy from shots_usd_rub where id=@min_id);
set @_tg = (select (sum((buy - @_sell_start)/(id + 1 - @min_id))/(@shots_number-1)) from shots_usd_rub where id>@min_id);
set @next_day_avg = concat(@next_day_avg,'_',cast((@_sell_start + 1.5*@_sell_start*@_tg) as decimal(11,8)));

set @_sell_start = (select buy from shots_eur_rub where id=@min_id);
set @_tg = (select (sum((buy - @_sell_start)/(id + 1 - @min_id))/(@shots_number-1)) from shots_eur_rub where id>@min_id);
set @next_day_avg = concat(@next_day_avg,'_',cast((@_sell_start + 1.5*@_sell_start*@_tg) as decimal(11,8)));

set @_sell_start = (select sell from shots_usd_rub where id=@min_id);
set @_tg = (select (sum((sell - @_sell_start)/(id + 1 - @min_id))/(@shots_number-1)) from shots_usd_rub where id>@min_id);
set @next_day_avg = concat(@next_day_avg,'_',cast((@_sell_start + 1.5*@_sell_start*@_tg) as decimal(11,8)));

set @_sell_start = (select sell from shots_eur_rub where id=@min_id);
set @_tg = (select (sum((sell - @_sell_start)/(id + 1 - @min_id))/(@shots_number-1)) from shots_eur_rub where id>@min_id);
set @next_day_avg = concat(@next_day_avg,'_',cast((@_sell_start + 1.5*@_sell_start*@_tg) as decimal(11,8)));

set @_sell_start = (select buy from shots_usd_eur where id=@min_id);
set @_tg = (select (sum((buy - @_sell_start)/(id + 1 - @min_id))/(@shots_number-1)) from shots_usd_eur where id>@min_id);
set @usd_eur_buy = (@_sell_start + 1.5*@_sell_start*@_tg);

set @_sell_start = (select sell from shots_usd_eur where id=@min_id);
set @_tg = (select (sum((sell - @_sell_start)/(id + 1 - @min_id))/(@shots_number-1)) from shots_usd_eur where id>@min_id);
set @usd_eur_sell = (@_sell_start + 1.5*@_sell_start*@_tg);

set @next_day_avg = concat(@next_day_avg,'_',cast((@usd_eur_sell - @usd_eur_buy) as decimal(11,8)));

set @_sell_start = (select buy from shots_eur_usd where id=@min_id);
set @_tg = (select (sum((buy - @_sell_start)/(id + 1 - @min_id))/(@shots_number-1)) from shots_eur_usd where id>@min_id);
set @usd_eur_buy = (@_sell_start + 1.5*@_sell_start*@_tg);

set @_sell_start = (select sell from shots_eur_usd where id=@min_id);
set @_tg = (select (sum((sell - @_sell_start)/(id + 1 - @min_id))/(@shots_number-1)) from shots_eur_usd where id>@min_id);
set @usd_eur_sell = (@_sell_start + 1.5*@_sell_start*@_tg);

set @next_day_avg = concat(@next_day_avg,'_',cast((@usd_eur_sell - @usd_eur_buy) as decimal(11,8)));

return @next_day_avg;
end;;

DROP FUNCTION IF EXISTS `new_shot`;;
CREATE FUNCTION `new_shot`(`buy1` decimal(12,9) unsigned, `buy2` decimal(12,9) unsigned, `buy3` decimal(12,9) unsigned, `buy4` decimal(12,9) unsigned, `sell1` decimal(12,9) unsigned, `sell2` decimal(12,9) unsigned, `sell3` decimal(12,9) unsigned, `sell4` decimal(12,9) unsigned) RETURNS char(2) CHARSET ascii
begin
declare need_id mediumint(8) unsigned;
insert into shots_master (id) values (null);
set @need_id = (select max(id) from shots_master limit 1);
insert into shots_usd_rub (sell, buy) values (buy1, sell1);
insert into shots_eur_rub (sell, buy) values (buy2, sell2);
insert into shots_usd_eur (sell, buy) values (buy3, sell3);
insert into shots_eur_usd (sell, buy) values (buy4, sell4);
return 'ok';
end;;

DELIMITER ;

DROP TABLE IF EXISTS `shots_eur_rub`;
CREATE TABLE `shots_eur_rub` (
  `sell` decimal(12,9) unsigned NOT NULL,
  `buy` decimal(12,9) unsigned NOT NULL,
  `id` mediumint(8) unsigned NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`),
  CONSTRAINT `shots_eur_rub_ibfk_1` FOREIGN KEY (`id`) REFERENCES `shots_master` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=183 DEFAULT CHARSET=ascii;

INSERT INTO `shots_eur_rub` (`sell`, `buy`, `id`) VALUES
(72.650000000,	69.800000000,	1),
(72.650000000,	69.800000000,	2),
(72.650000000,	69.800000000,	3),
(72.650000000,	69.800000000,	4),
(72.650000000,	69.800000000,	5),
(72.650000000,	69.800000000,	6),
(72.650000000,	69.800000000,	7),
(72.650000000,	69.800000000,	8),
(72.650000000,	69.800000000,	9),
(72.650000000,	69.800000000,	10),
(72.650000000,	69.800000000,	11),
(72.650000000,	69.800000000,	12),
(72.650000000,	69.800000000,	13),
(72.650000000,	69.800000000,	14),
(72.650000000,	69.800000000,	15),
(72.650000000,	69.800000000,	16),
(72.650000000,	69.800000000,	17),
(72.650000000,	69.800000000,	18),
(72.650000000,	69.800000000,	19),
(72.650000000,	69.800000000,	20),
(72.650000000,	69.800000000,	21),
(72.600000000,	69.800000000,	22),
(72.600000000,	69.800000000,	23),
(72.600000000,	69.800000000,	24),
(72.600000000,	69.800000000,	25),
(72.600000000,	69.800000000,	26),
(72.600000000,	69.800000000,	27),
(72.600000000,	69.800000000,	28),
(72.600000000,	69.800000000,	29),
(72.600000000,	69.800000000,	30),
(72.600000000,	69.800000000,	31),
(72.600000000,	69.800000000,	32),
(72.600000000,	69.800000000,	33),
(72.600000000,	69.800000000,	34),
(72.600000000,	69.800000000,	35),
(72.600000000,	69.800000000,	36),
(72.600000000,	69.800000000,	37),
(72.600000000,	69.800000000,	38),
(72.600000000,	69.800000000,	39),
(72.600000000,	69.800000000,	40),
(72.600000000,	69.800000000,	41),
(72.600000000,	69.800000000,	42),
(72.600000000,	69.800000000,	43),
(71.300000000,	68.550000000,	44),
(71.300000000,	68.550000000,	45),
(71.300000000,	68.550000000,	46),
(71.300000000,	68.550000000,	47),
(71.300000000,	68.550000000,	48),
(71.300000000,	68.550000000,	49),
(71.300000000,	68.550000000,	50),
(71.300000000,	68.550000000,	51),
(71.300000000,	68.550000000,	52),
(71.300000000,	68.550000000,	53),
(71.300000000,	68.550000000,	54),
(71.300000000,	68.550000000,	55),
(71.300000000,	68.550000000,	56),
(71.300000000,	68.550000000,	57),
(71.300000000,	68.550000000,	58),
(71.300000000,	68.550000000,	59),
(71.300000000,	68.550000000,	60),
(71.300000000,	68.550000000,	61),
(71.300000000,	68.550000000,	62),
(71.300000000,	68.550000000,	63),
(71.300000000,	68.550000000,	64),
(71.300000000,	68.550000000,	65),
(71.300000000,	68.550000000,	66),
(71.300000000,	68.550000000,	67),
(71.300000000,	68.550000000,	68),
(71.300000000,	68.550000000,	69),
(71.300000000,	68.550000000,	70),
(71.300000000,	68.550000000,	71),
(71.300000000,	68.550000000,	72),
(71.300000000,	68.550000000,	73),
(71.300000000,	68.550000000,	74),
(70.100000000,	67.350000000,	75),
(70.100000000,	67.350000000,	76),
(70.100000000,	67.350000000,	77),
(70.100000000,	67.350000000,	78),
(70.100000000,	67.350000000,	79),
(70.100000000,	67.350000000,	80),
(70.100000000,	67.350000000,	81),
(70.100000000,	67.350000000,	82),
(70.100000000,	67.350000000,	83),
(70.100000000,	67.350000000,	84),
(70.100000000,	67.350000000,	85),
(70.100000000,	67.350000000,	86),
(70.100000000,	67.350000000,	87),
(70.100000000,	67.350000000,	88),
(70.100000000,	67.350000000,	89),
(70.100000000,	67.350000000,	90),
(70.100000000,	67.350000000,	91),
(70.000000000,	67.250000000,	92),
(70.000000000,	67.250000000,	93),
(70.000000000,	67.250000000,	94),
(70.000000000,	67.250000000,	95),
(70.000000000,	67.250000000,	96),
(70.000000000,	67.250000000,	97),
(70.000000000,	67.250000000,	98),
(70.000000000,	67.250000000,	99),
(70.000000000,	67.250000000,	100),
(70.000000000,	67.250000000,	101),
(70.000000000,	67.250000000,	102),
(70.000000000,	67.250000000,	103),
(70.000000000,	67.250000000,	104),
(70.000000000,	67.250000000,	105),
(70.000000000,	67.250000000,	106),
(70.000000000,	67.250000000,	107),
(70.000000000,	67.250000000,	108),
(70.000000000,	67.250000000,	109),
(70.000000000,	67.250000000,	110),
(70.000000000,	67.250000000,	111),
(70.000000000,	67.250000000,	112),
(70.000000000,	67.250000000,	113),
(70.000000000,	67.250000000,	114),
(70.000000000,	67.250000000,	115),
(70.000000000,	67.250000000,	116),
(70.000000000,	67.250000000,	117),
(70.000000000,	67.250000000,	118),
(70.000000000,	67.250000000,	119),
(70.000000000,	67.250000000,	120),
(70.000000000,	67.250000000,	121),
(70.000000000,	67.250000000,	122),
(70.000000000,	67.250000000,	123),
(70.000000000,	67.250000000,	124),
(70.000000000,	67.250000000,	125),
(70.000000000,	67.250000000,	126),
(70.000000000,	67.250000000,	127),
(70.000000000,	67.250000000,	128),
(70.000000000,	67.250000000,	129),
(70.000000000,	67.250000000,	130),
(70.000000000,	67.250000000,	131),
(70.000000000,	67.250000000,	132),
(70.000000000,	67.250000000,	133),
(70.000000000,	67.250000000,	134),
(70.000000000,	67.250000000,	135),
(70.000000000,	67.250000000,	136),
(70.000000000,	67.250000000,	137),
(70.000000000,	67.250000000,	138),
(70.000000000,	67.250000000,	139),
(70.000000000,	67.250000000,	140),
(70.000000000,	67.250000000,	141),
(70.000000000,	67.250000000,	142),
(70.000000000,	67.250000000,	143),
(70.000000000,	67.250000000,	144),
(70.000000000,	67.250000000,	145),
(70.000000000,	67.250000000,	146),
(70.000000000,	67.250000000,	147),
(70.000000000,	67.250000000,	148),
(70.000000000,	67.250000000,	149),
(70.000000000,	67.250000000,	150),
(70.000000000,	67.250000000,	151),
(70.000000000,	67.250000000,	152),
(70.000000000,	67.250000000,	153),
(70.000000000,	67.250000000,	154),
(70.000000000,	67.250000000,	155),
(70.000000000,	67.250000000,	156),
(70.000000000,	67.250000000,	157),
(70.000000000,	67.250000000,	158),
(70.000000000,	67.250000000,	159),
(70.000000000,	67.250000000,	160),
(70.000000000,	67.250000000,	161),
(70.000000000,	67.250000000,	162),
(70.000000000,	67.250000000,	163),
(70.000000000,	67.250000000,	164),
(70.000000000,	67.250000000,	165),
(70.000000000,	67.250000000,	166),
(70.000000000,	67.250000000,	167),
(70.000000000,	67.250000000,	168),
(70.000000000,	67.250000000,	169),
(70.000000000,	67.250000000,	170),
(70.000000000,	67.250000000,	171),
(70.000000000,	67.250000000,	172),
(70.000000000,	67.250000000,	173),
(70.000000000,	67.250000000,	174),
(70.000000000,	67.250000000,	175),
(70.000000000,	67.250000000,	176),
(70.000000000,	67.250000000,	177),
(70.000000000,	67.250000000,	178),
(70.000000000,	67.250000000,	179),
(70.000000000,	67.250000000,	180),
(70.000000000,	67.250000000,	181),
(70.000000000,	67.250000000,	182);

DROP TABLE IF EXISTS `shots_eur_usd`;
CREATE TABLE `shots_eur_usd` (
  `sell` decimal(12,9) unsigned NOT NULL,
  `buy` decimal(12,9) unsigned NOT NULL,
  `id` mediumint(8) unsigned NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`),
  CONSTRAINT `shots_eur_usd_ibfk_1` FOREIGN KEY (`id`) REFERENCES `shots_master` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=183 DEFAULT CHARSET=ascii;

INSERT INTO `shots_eur_usd` (`sell`, `buy`, `id`) VALUES
(1.160000000,	1.110000000,	1),
(1.160000000,	1.110000000,	2),
(1.160000000,	1.110000000,	3),
(1.160000000,	1.110000000,	4),
(1.160000000,	1.110000000,	5),
(1.160000000,	1.110000000,	6),
(1.160000000,	1.110000000,	7),
(1.160000000,	1.110000000,	8),
(1.160000000,	1.110000000,	9),
(1.160000000,	1.110000000,	10),
(1.160000000,	1.110000000,	11),
(1.160000000,	1.110000000,	12),
(1.160000000,	1.110000000,	13),
(1.160000000,	1.110000000,	14),
(1.160000000,	1.110000000,	15),
(1.160000000,	1.110000000,	16),
(1.160000000,	1.110000000,	17),
(1.160000000,	1.110000000,	18),
(1.160000000,	1.110000000,	19),
(1.160000000,	1.110000000,	20),
(1.160000000,	1.110000000,	21),
(1.160000000,	1.110000000,	22),
(1.160000000,	1.110000000,	23),
(1.160000000,	1.110000000,	24),
(1.160000000,	1.110000000,	25),
(1.160000000,	1.110000000,	26),
(1.160000000,	1.110000000,	27),
(1.160000000,	1.110000000,	28),
(1.160000000,	1.110000000,	29),
(1.160000000,	1.110000000,	30),
(1.160000000,	1.110000000,	31),
(1.160000000,	1.110000000,	32),
(1.160000000,	1.110000000,	33),
(1.160000000,	1.110000000,	34),
(1.160000000,	1.110000000,	35),
(1.160000000,	1.110000000,	36),
(1.160000000,	1.110000000,	37),
(1.160000000,	1.110000000,	38),
(1.160000000,	1.110000000,	39),
(1.160000000,	1.110000000,	40),
(1.160000000,	1.110000000,	41),
(1.160000000,	1.110000000,	42),
(1.160000000,	1.110000000,	43),
(1.140000000,	1.090000000,	44),
(1.140000000,	1.090000000,	45),
(1.140000000,	1.090000000,	46),
(1.140000000,	1.090000000,	47),
(1.140000000,	1.090000000,	48),
(1.140000000,	1.090000000,	49),
(1.140000000,	1.090000000,	50),
(1.140000000,	1.090000000,	51),
(1.140000000,	1.090000000,	52),
(1.140000000,	1.090000000,	53),
(1.140000000,	1.090000000,	54),
(1.140000000,	1.090000000,	55),
(1.140000000,	1.090000000,	56),
(1.140000000,	1.090000000,	57),
(1.140000000,	1.090000000,	58),
(1.140000000,	1.090000000,	59),
(1.140000000,	1.090000000,	60),
(1.140000000,	1.090000000,	61),
(1.140000000,	1.090000000,	62),
(1.140000000,	1.090000000,	63),
(1.140000000,	1.090000000,	64),
(1.140000000,	1.090000000,	65),
(1.140000000,	1.090000000,	66),
(1.140000000,	1.090000000,	67),
(1.140000000,	1.090000000,	68),
(1.140000000,	1.090000000,	69),
(1.140000000,	1.090000000,	70),
(1.140000000,	1.090000000,	71),
(1.140000000,	1.090000000,	72),
(1.140000000,	1.090000000,	73),
(1.140000000,	1.090000000,	74),
(1.130000000,	1.090000000,	75),
(1.130000000,	1.090000000,	76),
(1.130000000,	1.090000000,	77),
(1.130000000,	1.090000000,	78),
(1.130000000,	1.090000000,	79),
(1.130000000,	1.090000000,	80),
(1.130000000,	1.090000000,	81),
(1.130000000,	1.090000000,	82),
(1.130000000,	1.090000000,	83),
(1.130000000,	1.090000000,	84),
(1.130000000,	1.090000000,	85),
(1.130000000,	1.090000000,	86),
(1.130000000,	1.090000000,	87),
(1.130000000,	1.090000000,	88),
(1.130000000,	1.090000000,	89),
(1.130000000,	1.090000000,	90),
(1.130000000,	1.090000000,	91),
(1.120000000,	1.080000000,	92),
(1.120000000,	1.080000000,	93),
(1.120000000,	1.080000000,	94),
(1.120000000,	1.080000000,	95),
(1.120000000,	1.080000000,	96),
(1.120000000,	1.080000000,	97),
(1.120000000,	1.080000000,	98),
(1.120000000,	1.080000000,	99),
(1.120000000,	1.080000000,	100),
(1.120000000,	1.080000000,	101),
(1.120000000,	1.080000000,	102),
(1.120000000,	1.080000000,	103),
(1.120000000,	1.080000000,	104),
(1.120000000,	1.080000000,	105),
(1.120000000,	1.080000000,	106),
(1.120000000,	1.080000000,	107),
(1.120000000,	1.080000000,	108),
(1.120000000,	1.080000000,	109),
(1.120000000,	1.080000000,	110),
(1.120000000,	1.080000000,	111),
(1.120000000,	1.080000000,	112),
(1.120000000,	1.080000000,	113),
(1.120000000,	1.080000000,	114),
(1.120000000,	1.080000000,	115),
(1.120000000,	1.080000000,	116),
(1.120000000,	1.080000000,	117),
(1.120000000,	1.080000000,	118),
(1.120000000,	1.080000000,	119),
(1.120000000,	1.080000000,	120),
(1.120000000,	1.080000000,	121),
(1.120000000,	1.080000000,	122),
(1.120000000,	1.080000000,	123),
(1.120000000,	1.080000000,	124),
(1.120000000,	1.080000000,	125),
(1.120000000,	1.080000000,	126),
(1.120000000,	1.080000000,	127),
(1.120000000,	1.080000000,	128),
(1.120000000,	1.080000000,	129),
(1.120000000,	1.080000000,	130),
(1.120000000,	1.080000000,	131),
(1.120000000,	1.080000000,	132),
(1.120000000,	1.080000000,	133),
(1.120000000,	1.080000000,	134),
(1.120000000,	1.080000000,	135),
(1.120000000,	1.080000000,	136),
(1.120000000,	1.080000000,	137),
(1.120000000,	1.080000000,	138),
(1.120000000,	1.080000000,	139),
(1.120000000,	1.080000000,	140),
(1.120000000,	1.080000000,	141),
(1.120000000,	1.080000000,	142),
(1.120000000,	1.080000000,	143),
(1.120000000,	1.080000000,	144),
(1.120000000,	1.080000000,	145),
(1.120000000,	1.080000000,	146),
(1.120000000,	1.080000000,	147),
(1.120000000,	1.080000000,	148),
(1.120000000,	1.080000000,	149),
(1.120000000,	1.080000000,	150),
(1.120000000,	1.080000000,	151),
(1.120000000,	1.080000000,	152),
(1.120000000,	1.080000000,	153),
(1.120000000,	1.080000000,	154),
(1.120000000,	1.080000000,	155),
(1.120000000,	1.080000000,	156),
(1.120000000,	1.080000000,	157),
(1.120000000,	1.080000000,	158),
(1.120000000,	1.080000000,	159),
(1.120000000,	1.080000000,	160),
(1.120000000,	1.080000000,	161),
(1.120000000,	1.080000000,	162),
(1.120000000,	1.080000000,	163),
(1.120000000,	1.080000000,	164),
(1.120000000,	1.080000000,	165),
(1.120000000,	1.080000000,	166),
(1.120000000,	1.080000000,	167),
(1.120000000,	1.080000000,	168),
(1.120000000,	1.080000000,	169),
(1.120000000,	1.080000000,	170),
(1.120000000,	1.080000000,	171),
(1.120000000,	1.080000000,	172),
(1.120000000,	1.080000000,	173),
(1.120000000,	1.080000000,	174),
(1.120000000,	1.080000000,	175),
(1.120000000,	1.080000000,	176),
(1.120000000,	1.080000000,	177),
(1.120000000,	1.080000000,	178),
(1.120000000,	1.080000000,	179),
(1.120000000,	1.080000000,	180),
(1.120000000,	1.080000000,	181),
(1.120000000,	1.080000000,	182);

DROP TABLE IF EXISTS `shots_master`;
CREATE TABLE `shots_master` (
  `id` mediumint(8) unsigned NOT NULL AUTO_INCREMENT,
  `time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=183 DEFAULT CHARSET=ascii;

INSERT INTO `shots_master` (`id`, `time`) VALUES
(1,	'2015-10-21 21:08:31'),
(2,	'2015-10-21 21:38:30'),
(3,	'2015-10-21 22:08:30'),
(4,	'2015-10-21 22:38:30'),
(5,	'2015-10-21 23:08:30'),
(6,	'2015-10-21 23:38:30'),
(7,	'2015-10-22 00:08:30'),
(8,	'2015-10-22 00:38:30'),
(9,	'2015-10-22 01:08:30'),
(10,	'2015-10-22 01:38:30'),
(11,	'2015-10-22 02:08:30'),
(12,	'2015-10-22 02:38:30'),
(13,	'2015-10-22 03:08:30'),
(14,	'2015-10-22 03:38:30'),
(15,	'2015-10-22 04:08:30'),
(16,	'2015-10-22 04:38:30'),
(17,	'2015-10-22 05:08:30'),
(18,	'2015-10-22 05:38:30'),
(19,	'2015-10-22 06:08:30'),
(20,	'2015-10-22 06:38:30'),
(21,	'2015-10-22 07:08:30'),
(22,	'2015-10-22 07:38:33'),
(23,	'2015-10-22 08:08:30'),
(24,	'2015-10-22 08:38:30'),
(25,	'2015-10-22 09:08:30'),
(26,	'2015-10-22 09:38:33'),
(27,	'2015-10-22 10:08:30'),
(28,	'2015-10-22 10:38:30'),
(29,	'2015-10-22 11:08:30'),
(30,	'2015-10-22 11:38:30'),
(31,	'2015-10-22 12:08:30'),
(32,	'2015-10-22 12:38:30'),
(33,	'2015-10-22 13:08:30'),
(34,	'2015-10-22 13:38:33'),
(35,	'2015-10-22 14:05:28'),
(36,	'2015-10-22 14:06:13'),
(37,	'2015-10-22 14:22:52'),
(38,	'2015-10-22 14:27:38'),
(39,	'2015-10-22 14:29:19'),
(40,	'2015-10-22 14:31:19'),
(41,	'2015-10-22 14:31:40'),
(42,	'2015-10-22 15:01:40'),
(43,	'2015-10-22 15:31:41'),
(44,	'2015-10-22 16:01:40'),
(45,	'2015-10-22 16:31:40'),
(46,	'2015-10-22 17:01:40'),
(47,	'2015-10-22 17:31:40'),
(48,	'2015-10-22 18:01:40'),
(49,	'2015-10-22 18:31:40'),
(50,	'2015-10-22 19:01:40'),
(51,	'2015-10-22 19:31:40'),
(52,	'2015-10-22 20:01:40'),
(53,	'2015-10-22 20:31:40'),
(54,	'2015-10-22 21:01:40'),
(55,	'2015-10-22 21:31:40'),
(56,	'2015-10-22 22:01:40'),
(57,	'2015-10-22 22:31:40'),
(58,	'2015-10-22 23:01:40'),
(59,	'2015-10-22 23:31:53'),
(60,	'2015-10-23 00:01:41'),
(61,	'2015-10-23 00:31:48'),
(62,	'2015-10-23 01:01:44'),
(63,	'2015-10-23 01:31:46'),
(64,	'2015-10-23 02:01:40'),
(65,	'2015-10-23 02:31:40'),
(66,	'2015-10-23 03:01:40'),
(67,	'2015-10-23 03:31:43'),
(68,	'2015-10-23 04:01:40'),
(69,	'2015-10-23 04:31:45'),
(70,	'2015-10-23 05:01:43'),
(71,	'2015-10-23 05:31:40'),
(72,	'2015-10-23 06:01:40'),
(73,	'2015-10-23 06:31:40'),
(74,	'2015-10-23 07:01:40'),
(75,	'2015-10-23 07:31:40'),
(76,	'2015-10-23 08:01:40'),
(77,	'2015-10-23 08:31:42'),
(78,	'2015-10-23 09:01:40'),
(79,	'2015-10-23 09:31:41'),
(80,	'2015-10-23 10:01:40'),
(81,	'2015-10-23 10:31:40'),
(82,	'2015-10-23 11:01:40'),
(83,	'2015-10-23 11:31:40'),
(84,	'2015-10-23 12:01:40'),
(85,	'2015-10-23 12:31:40'),
(86,	'2015-10-23 13:01:40'),
(87,	'2015-10-23 13:31:40'),
(88,	'2015-10-23 14:01:40'),
(89,	'2015-10-23 14:31:40'),
(90,	'2015-10-23 15:01:40'),
(91,	'2015-10-23 15:31:40'),
(92,	'2015-10-23 16:01:40'),
(93,	'2015-10-23 16:31:40'),
(94,	'2015-10-23 17:01:40'),
(95,	'2015-10-23 17:31:40'),
(96,	'2015-10-23 18:01:40'),
(97,	'2015-10-23 18:31:40'),
(98,	'2015-10-23 19:01:40'),
(99,	'2015-10-23 19:31:40'),
(100,	'2015-10-23 20:01:40'),
(101,	'2015-10-23 20:31:40'),
(102,	'2015-10-23 21:01:40'),
(103,	'2015-10-23 21:31:40'),
(104,	'2015-10-23 22:01:41'),
(105,	'2015-10-23 22:31:40'),
(106,	'2015-10-23 23:01:40'),
(107,	'2015-10-23 23:31:40'),
(108,	'2015-10-24 00:01:40'),
(109,	'2015-10-24 00:31:40'),
(110,	'2015-10-24 01:01:40'),
(111,	'2015-10-24 01:31:40'),
(112,	'2015-10-24 02:01:40'),
(113,	'2015-10-24 02:31:40'),
(114,	'2015-10-24 03:01:40'),
(115,	'2015-10-24 03:31:40'),
(116,	'2015-10-24 04:01:40'),
(117,	'2015-10-24 04:31:40'),
(118,	'2015-10-24 05:01:40'),
(119,	'2015-10-24 05:31:40'),
(120,	'2015-10-24 06:01:40'),
(121,	'2015-10-24 06:31:40'),
(122,	'2015-10-24 07:01:40'),
(123,	'2015-10-24 07:31:40'),
(124,	'2015-10-24 08:01:40'),
(125,	'2015-10-24 08:31:40'),
(126,	'2015-10-24 09:01:40'),
(127,	'2015-10-24 09:31:40'),
(128,	'2015-10-24 10:01:40'),
(129,	'2015-10-24 10:31:40'),
(130,	'2015-10-24 11:01:40'),
(131,	'2015-10-24 11:31:40'),
(132,	'2015-10-24 12:01:40'),
(133,	'2015-10-24 12:31:40'),
(134,	'2015-10-24 13:01:43'),
(135,	'2015-10-24 13:31:40'),
(136,	'2015-10-24 14:01:40'),
(137,	'2015-10-24 14:31:41'),
(138,	'2015-10-24 15:01:47'),
(139,	'2015-10-24 15:31:40'),
(140,	'2015-10-24 16:01:41'),
(141,	'2015-10-24 16:31:46'),
(142,	'2015-10-24 17:01:46'),
(143,	'2015-10-24 17:31:44'),
(144,	'2015-10-24 18:01:40'),
(145,	'2015-10-24 18:31:40'),
(146,	'2015-10-24 19:01:41'),
(147,	'2015-10-24 19:31:48'),
(148,	'2015-10-24 20:01:40'),
(149,	'2015-10-24 20:31:40'),
(150,	'2015-10-24 21:01:43'),
(151,	'2015-10-24 21:31:40'),
(152,	'2015-10-24 22:01:40'),
(153,	'2015-10-24 22:31:41'),
(154,	'2015-10-25 09:02:17'),
(155,	'2015-10-25 09:32:16'),
(156,	'2015-10-25 10:02:16'),
(157,	'2015-10-25 10:32:21'),
(158,	'2015-10-25 11:02:17'),
(159,	'2015-10-25 11:32:17'),
(160,	'2015-10-25 12:02:17'),
(161,	'2015-10-25 12:32:16'),
(162,	'2015-10-25 13:02:17'),
(163,	'2015-10-25 13:32:17'),
(164,	'2015-10-25 14:02:16'),
(165,	'2015-10-25 14:32:16'),
(166,	'2015-10-25 15:02:17'),
(167,	'2015-10-25 15:32:16'),
(168,	'2015-10-25 16:02:16'),
(169,	'2015-10-25 16:32:16'),
(170,	'2015-10-25 17:02:16'),
(171,	'2015-10-25 17:32:16'),
(172,	'2015-10-25 18:02:17'),
(173,	'2015-10-25 18:32:20'),
(174,	'2015-10-25 19:02:17'),
(175,	'2015-10-25 19:32:16'),
(176,	'2015-10-25 20:02:17'),
(177,	'2015-10-25 20:32:17'),
(178,	'2015-10-25 21:02:17'),
(179,	'2015-10-25 21:32:17'),
(180,	'2015-10-25 22:02:16'),
(181,	'2015-10-25 22:32:17'),
(182,	'2015-10-25 23:02:16');

DROP TABLE IF EXISTS `shots_usd_eur`;
CREATE TABLE `shots_usd_eur` (
  `sell` decimal(12,9) unsigned NOT NULL,
  `buy` decimal(12,9) unsigned NOT NULL,
  `id` mediumint(8) unsigned NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`),
  CONSTRAINT `shots_usd_eur_ibfk_1` FOREIGN KEY (`id`) REFERENCES `shots_master` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=183 DEFAULT CHARSET=ascii;

INSERT INTO `shots_usd_eur` (`sell`, `buy`, `id`) VALUES
(0.900900901,	0.862068966,	1),
(0.900900901,	0.862068966,	2),
(0.900900901,	0.862068966,	3),
(0.900900901,	0.862068966,	4),
(0.900900901,	0.862068966,	5),
(0.900900901,	0.862068966,	6),
(0.900900901,	0.862068966,	7),
(0.900900901,	0.862068966,	8),
(0.900900901,	0.862068966,	9),
(0.900900901,	0.862068966,	10),
(0.900900901,	0.862068966,	11),
(0.900900901,	0.862068966,	12),
(0.900900901,	0.862068966,	13),
(0.900900901,	0.862068966,	14),
(0.900900901,	0.862068966,	15),
(0.900900901,	0.862068966,	16),
(0.900900901,	0.862068966,	17),
(0.900900901,	0.862068966,	18),
(0.900900901,	0.862068966,	19),
(0.900900901,	0.862068966,	20),
(0.900900901,	0.862068966,	21),
(0.900900901,	0.862068966,	22),
(0.900900901,	0.862068966,	23),
(0.900900901,	0.862068966,	24),
(0.900900901,	0.862068966,	25),
(0.900900901,	0.862068966,	26),
(0.900900901,	0.862068966,	27),
(0.900900901,	0.862068966,	28),
(0.900900901,	0.862068966,	29),
(0.900900901,	0.862068966,	30),
(0.900900901,	0.862068966,	31),
(0.900900901,	0.862068966,	32),
(0.900900901,	0.862068966,	33),
(0.900900901,	0.862068966,	34),
(0.900900901,	0.862068966,	35),
(0.900900901,	0.862068966,	36),
(0.900900901,	0.862068966,	37),
(0.900900901,	0.862068966,	38),
(0.900900901,	0.862068966,	39),
(0.900900901,	0.862068966,	40),
(0.900900901,	0.862068966,	41),
(0.900900901,	0.862068966,	42),
(0.900900901,	0.862068966,	43),
(0.917431193,	0.877192983,	44),
(0.917431193,	0.877192983,	45),
(0.917431193,	0.877192983,	46),
(0.917431193,	0.877192983,	47),
(0.917431193,	0.877192983,	48),
(0.917431193,	0.877192983,	49),
(0.917431193,	0.877192983,	50),
(0.917431193,	0.877192983,	51),
(0.917431193,	0.877192983,	52),
(0.917431193,	0.877192983,	53),
(0.917431193,	0.877192983,	54),
(0.917431193,	0.877192983,	55),
(0.917431193,	0.877192983,	56),
(0.917431193,	0.877192983,	57),
(0.917431193,	0.877192983,	58),
(0.917431193,	0.877192983,	59),
(0.917431193,	0.877192983,	60),
(0.917431193,	0.877192983,	61),
(0.917431193,	0.877192983,	62),
(0.917431193,	0.877192983,	63),
(0.917431193,	0.877192983,	64),
(0.917431193,	0.877192983,	65),
(0.917431193,	0.877192983,	66),
(0.917431193,	0.877192983,	67),
(0.917431193,	0.877192983,	68),
(0.917431193,	0.877192983,	69),
(0.917431193,	0.877192983,	70),
(0.917431193,	0.877192983,	71),
(0.917431193,	0.877192983,	72),
(0.917431193,	0.877192983,	73),
(0.917431193,	0.877192983,	74),
(0.917431193,	0.884955752,	75),
(0.917431193,	0.884955752,	76),
(0.917431193,	0.884955752,	77),
(0.917431193,	0.884955752,	78),
(0.917431193,	0.884955752,	79),
(0.917431193,	0.884955752,	80),
(0.917431193,	0.884955752,	81),
(0.917431193,	0.884955752,	82),
(0.917431193,	0.884955752,	83),
(0.917431193,	0.884955752,	84),
(0.917431193,	0.884955752,	85),
(0.917431193,	0.884955752,	86),
(0.917431193,	0.884955752,	87),
(0.917431193,	0.884955752,	88),
(0.917431193,	0.884955752,	89),
(0.917431193,	0.884955752,	90),
(0.917431193,	0.884955752,	91),
(0.925925926,	0.892857143,	92),
(0.925925926,	0.892857143,	93),
(0.925925926,	0.892857143,	94),
(0.925925926,	0.892857143,	95),
(0.925925926,	0.892857143,	96),
(0.925925926,	0.892857143,	97),
(0.925925926,	0.892857143,	98),
(0.925925926,	0.892857143,	99),
(0.925925926,	0.892857143,	100),
(0.925925926,	0.892857143,	101),
(0.925925926,	0.892857143,	102),
(0.925925926,	0.892857143,	103),
(0.925925926,	0.892857143,	104),
(0.925925926,	0.892857143,	105),
(0.925925926,	0.892857143,	106),
(0.925925926,	0.892857143,	107),
(0.925925926,	0.892857143,	108),
(0.925925926,	0.892857143,	109),
(0.925925926,	0.892857143,	110),
(0.925925926,	0.892857143,	111),
(0.925925926,	0.892857143,	112),
(0.925925926,	0.892857143,	113),
(0.925925926,	0.892857143,	114),
(0.925925926,	0.892857143,	115),
(0.925925926,	0.892857143,	116),
(0.925925926,	0.892857143,	117),
(0.925925926,	0.892857143,	118),
(0.925925926,	0.892857143,	119),
(0.925925926,	0.892857143,	120),
(0.925925926,	0.892857143,	121),
(0.925925926,	0.892857143,	122),
(0.925925926,	0.892857143,	123),
(0.925925926,	0.892857143,	124),
(0.925925926,	0.892857143,	125),
(0.925925926,	0.892857143,	126),
(0.925925926,	0.892857143,	127),
(0.925925926,	0.892857143,	128),
(0.925925926,	0.892857143,	129),
(0.925925926,	0.892857143,	130),
(0.925925926,	0.892857143,	131),
(0.925925926,	0.892857143,	132),
(0.925925926,	0.892857143,	133),
(0.925925926,	0.892857143,	134),
(0.925925926,	0.892857143,	135),
(0.925925926,	0.892857143,	136),
(0.925925926,	0.892857143,	137),
(0.925925926,	0.892857143,	138),
(0.925925926,	0.892857143,	139),
(0.925925926,	0.892857143,	140),
(0.925925926,	0.892857143,	141),
(0.925925926,	0.892857143,	142),
(0.925925926,	0.892857143,	143),
(0.925925926,	0.892857143,	144),
(0.925925926,	0.892857143,	145),
(0.925925926,	0.892857143,	146),
(0.925925926,	0.892857143,	147),
(0.925925926,	0.892857143,	148),
(0.925925926,	0.892857143,	149),
(0.925925926,	0.892857143,	150),
(0.925925926,	0.892857143,	151),
(0.925925926,	0.892857143,	152),
(0.925925926,	0.892857143,	153),
(0.925925926,	0.892857143,	154),
(0.925925926,	0.892857143,	155),
(0.925925926,	0.892857143,	156),
(0.925925926,	0.892857143,	157),
(0.925925926,	0.892857143,	158),
(0.925925926,	0.892857143,	159),
(0.925925926,	0.892857143,	160),
(0.925925926,	0.892857143,	161),
(0.925925926,	0.892857143,	162),
(0.925925926,	0.892857143,	163),
(0.925925926,	0.892857143,	164),
(0.925925926,	0.892857143,	165),
(0.925925926,	0.892857143,	166),
(0.925925926,	0.892857143,	167),
(0.925925926,	0.892857143,	168),
(0.925925926,	0.892857143,	169),
(0.925925926,	0.892857143,	170),
(0.925925926,	0.892857143,	171),
(0.925925926,	0.892857143,	172),
(0.925925926,	0.892857143,	173),
(0.925925926,	0.892857143,	174),
(0.925925926,	0.892857143,	175),
(0.925925926,	0.892857143,	176),
(0.925925926,	0.892857143,	177),
(0.925925926,	0.892857143,	178),
(0.925925926,	0.892857143,	179),
(0.925925926,	0.892857143,	180),
(0.925925926,	0.892857143,	181),
(0.925925926,	0.892857143,	182);

DROP TABLE IF EXISTS `shots_usd_rub`;
CREATE TABLE `shots_usd_rub` (
  `sell` decimal(12,9) unsigned NOT NULL,
  `buy` decimal(12,9) unsigned NOT NULL,
  `id` mediumint(8) unsigned NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`),
  CONSTRAINT `shots_usd_rub_ibfk_1` FOREIGN KEY (`id`) REFERENCES `shots_master` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=183 DEFAULT CHARSET=ascii;

INSERT INTO `shots_usd_rub` (`sell`, `buy`, `id`) VALUES
(64.050000000,	61.550000000,	1),
(64.050000000,	61.550000000,	2),
(64.050000000,	61.550000000,	3),
(64.050000000,	61.550000000,	4),
(64.050000000,	61.550000000,	5),
(64.050000000,	61.550000000,	6),
(64.050000000,	61.550000000,	7),
(64.050000000,	61.550000000,	8),
(64.050000000,	61.550000000,	9),
(64.050000000,	61.550000000,	10),
(64.050000000,	61.550000000,	11),
(64.050000000,	61.550000000,	12),
(64.050000000,	61.550000000,	13),
(64.050000000,	61.550000000,	14),
(64.050000000,	61.550000000,	15),
(64.050000000,	61.550000000,	16),
(64.050000000,	61.550000000,	17),
(64.050000000,	61.550000000,	18),
(64.050000000,	61.550000000,	19),
(64.050000000,	61.550000000,	20),
(64.050000000,	61.550000000,	21),
(64.050000000,	61.550000000,	22),
(64.050000000,	61.550000000,	23),
(64.050000000,	61.550000000,	24),
(64.050000000,	61.550000000,	25),
(64.050000000,	61.550000000,	26),
(64.050000000,	61.550000000,	27),
(64.050000000,	61.550000000,	28),
(64.050000000,	61.550000000,	29),
(64.050000000,	61.550000000,	30),
(64.050000000,	61.550000000,	31),
(64.050000000,	61.550000000,	32),
(64.050000000,	61.550000000,	33),
(64.050000000,	61.550000000,	34),
(64.050000000,	61.550000000,	35),
(64.050000000,	61.550000000,	36),
(64.050000000,	61.550000000,	37),
(64.050000000,	61.550000000,	38),
(64.050000000,	61.550000000,	39),
(64.050000000,	61.550000000,	40),
(64.050000000,	61.550000000,	41),
(64.050000000,	61.550000000,	42),
(64.050000000,	61.550000000,	43),
(63.950000000,	61.450000000,	44),
(63.950000000,	61.450000000,	45),
(63.950000000,	61.450000000,	46),
(63.950000000,	61.450000000,	47),
(63.950000000,	61.450000000,	48),
(63.950000000,	61.450000000,	49),
(63.950000000,	61.450000000,	50),
(63.950000000,	61.450000000,	51),
(63.950000000,	61.450000000,	52),
(63.950000000,	61.450000000,	53),
(63.950000000,	61.450000000,	54),
(63.950000000,	61.450000000,	55),
(63.950000000,	61.450000000,	56),
(63.950000000,	61.450000000,	57),
(63.950000000,	61.450000000,	58),
(63.950000000,	61.450000000,	59),
(63.950000000,	61.450000000,	60),
(63.950000000,	61.450000000,	61),
(63.950000000,	61.450000000,	62),
(63.950000000,	61.450000000,	63),
(63.950000000,	61.450000000,	64),
(63.950000000,	61.450000000,	65),
(63.950000000,	61.450000000,	66),
(63.950000000,	61.450000000,	67),
(63.950000000,	61.450000000,	68),
(63.950000000,	61.450000000,	69),
(63.950000000,	61.450000000,	70),
(63.950000000,	61.450000000,	71),
(63.950000000,	61.450000000,	72),
(63.950000000,	61.450000000,	73),
(63.950000000,	61.450000000,	74),
(63.100000000,	60.650000000,	75),
(63.100000000,	60.650000000,	76),
(63.100000000,	60.650000000,	77),
(63.100000000,	60.650000000,	78),
(63.100000000,	60.650000000,	79),
(63.100000000,	60.650000000,	80),
(63.100000000,	60.650000000,	81),
(63.100000000,	60.650000000,	82),
(63.100000000,	60.650000000,	83),
(63.100000000,	60.650000000,	84),
(63.100000000,	60.650000000,	85),
(63.100000000,	60.650000000,	86),
(63.100000000,	60.650000000,	87),
(63.100000000,	60.650000000,	88),
(63.100000000,	60.650000000,	89),
(63.100000000,	60.650000000,	90),
(63.100000000,	60.650000000,	91),
(63.550000000,	61.050000000,	92),
(63.550000000,	61.050000000,	93),
(63.550000000,	61.050000000,	94),
(63.550000000,	61.050000000,	95),
(63.550000000,	61.050000000,	96),
(63.550000000,	61.050000000,	97),
(63.550000000,	61.050000000,	98),
(63.550000000,	61.050000000,	99),
(63.550000000,	61.050000000,	100),
(63.550000000,	61.050000000,	101),
(63.550000000,	61.050000000,	102),
(63.550000000,	61.050000000,	103),
(63.550000000,	61.050000000,	104),
(63.550000000,	61.050000000,	105),
(63.550000000,	61.050000000,	106),
(63.550000000,	61.050000000,	107),
(63.550000000,	61.050000000,	108),
(63.550000000,	61.050000000,	109),
(63.550000000,	61.050000000,	110),
(63.550000000,	61.050000000,	111),
(63.550000000,	61.050000000,	112),
(63.550000000,	61.050000000,	113),
(63.550000000,	61.050000000,	114),
(63.550000000,	61.050000000,	115),
(63.550000000,	61.050000000,	116),
(63.550000000,	61.050000000,	117),
(63.550000000,	61.050000000,	118),
(63.550000000,	61.050000000,	119),
(63.550000000,	61.050000000,	120),
(63.550000000,	61.050000000,	121),
(63.550000000,	61.050000000,	122),
(63.550000000,	61.050000000,	123),
(63.550000000,	61.050000000,	124),
(63.550000000,	61.050000000,	125),
(63.550000000,	61.050000000,	126),
(63.550000000,	61.050000000,	127),
(63.550000000,	61.050000000,	128),
(63.550000000,	61.050000000,	129),
(63.550000000,	61.050000000,	130),
(63.550000000,	61.050000000,	131),
(63.550000000,	61.050000000,	132),
(63.550000000,	61.050000000,	133),
(63.550000000,	61.050000000,	134),
(63.550000000,	61.050000000,	135),
(63.550000000,	61.050000000,	136),
(63.550000000,	61.050000000,	137),
(63.550000000,	61.050000000,	138),
(63.550000000,	61.050000000,	139),
(63.550000000,	61.050000000,	140),
(63.550000000,	61.050000000,	141),
(63.550000000,	61.050000000,	142),
(63.550000000,	61.050000000,	143),
(63.550000000,	61.050000000,	144),
(63.550000000,	61.050000000,	145),
(63.550000000,	61.050000000,	146),
(63.550000000,	61.050000000,	147),
(63.550000000,	61.050000000,	148),
(63.550000000,	61.050000000,	149),
(63.550000000,	61.050000000,	150),
(63.550000000,	61.050000000,	151),
(63.550000000,	61.050000000,	152),
(63.550000000,	61.050000000,	153),
(63.550000000,	61.050000000,	154),
(63.550000000,	61.050000000,	155),
(63.550000000,	61.050000000,	156),
(63.550000000,	61.050000000,	157),
(63.550000000,	61.050000000,	158),
(63.550000000,	61.050000000,	159),
(63.550000000,	61.050000000,	160),
(63.550000000,	61.050000000,	161),
(63.550000000,	61.050000000,	162),
(63.550000000,	61.050000000,	163),
(63.550000000,	61.050000000,	164),
(63.550000000,	61.050000000,	165),
(63.550000000,	61.050000000,	166),
(63.550000000,	61.050000000,	167),
(63.550000000,	61.050000000,	168),
(63.550000000,	61.050000000,	169),
(63.550000000,	61.050000000,	170),
(63.550000000,	61.050000000,	171),
(63.550000000,	61.050000000,	172),
(63.550000000,	61.050000000,	173),
(63.550000000,	61.050000000,	174),
(63.550000000,	61.050000000,	175),
(63.550000000,	61.050000000,	176),
(63.550000000,	61.050000000,	177),
(63.550000000,	61.050000000,	178),
(63.550000000,	61.050000000,	179),
(63.550000000,	61.050000000,	180),
(63.550000000,	61.050000000,	181),
(63.550000000,	61.050000000,	182);

DROP VIEW IF EXISTS `show_actual_shot`;
CREATE TABLE `show_actual_shot` (`time` timestamp, `usd_rub` decimal(12,9) unsigned, `eur_rub` decimal(12,9) unsigned, `usd_eur` decimal(12,9) unsigned, `eur_usd` decimal(12,9) unsigned, `avg_usd` decimal(16,13), `avg_eur` decimal(16,13));


DROP TABLE IF EXISTS `show_actual_shot`;
CREATE ALGORITHM=UNDEFINED SQL SECURITY DEFINER VIEW `show_actual_shot` AS (select `master`.`time` AS `time`,`shots_usd_rub`.`buy` AS `usd_rub`,`shots_eur_rub`.`buy` AS `eur_rub`,`shots_usd_eur`.`buy` AS `usd_eur`,`shots_eur_usd`.`buy` AS `eur_usd`,(select avg(`shots_usd_rub`.`buy`) from `shots_usd_rub` where (`shots_usd_rub`.`id` > ((select max(`shots_master`.`id`) from `shots_master`) - 31))) AS `avg_usd`,(select avg(`shots_eur_rub`.`buy`) from `shots_eur_rub` where (`shots_eur_rub`.`id` > ((select max(`shots_master`.`id`) from `shots_master`) - 31))) AS `avg_eur` from ((((`shots_usd_rub` left join `shots_master` `master` on((`master`.`id` = `shots_usd_rub`.`id`))) left join `shots_eur_rub` on((`master`.`id` = `shots_eur_rub`.`id`))) left join `shots_usd_eur` on((`master`.`id` = `shots_usd_eur`.`id`))) left join `shots_eur_usd` on((`master`.`id` = `shots_eur_usd`.`id`))) group by `master`.`id` having (`master`.`id` = (select max(`shots_master`.`id`) from `shots_master`)) limit 1) union (select `master`.`time` AS `time`,`shots_usd_rub`.`sell` AS `usd_rub`,`shots_eur_rub`.`sell` AS `eur_rub`,`shots_usd_eur`.`sell` AS `usd_eur`,`shots_eur_usd`.`sell` AS `eur_usd`,(select avg(`shots_usd_rub`.`sell`) from `shots_usd_rub` where (`shots_usd_rub`.`id` > ((select max(`shots_master`.`id`) from `shots_master`) - 31))) AS `avg_usd`,(select avg(`shots_eur_rub`.`sell`) from `shots_eur_rub` where (`shots_eur_rub`.`id` > ((select max(`shots_master`.`id`) from `shots_master`) - 31))) AS `avg_eur` from ((((`shots_usd_rub` left join `shots_master` `master` on((`master`.`id` = `shots_usd_rub`.`id`))) left join `shots_eur_rub` on((`master`.`id` = `shots_eur_rub`.`id`))) left join `shots_usd_eur` on((`master`.`id` = `shots_usd_eur`.`id`))) left join `shots_eur_usd` on((`master`.`id` = `shots_eur_usd`.`id`))) group by `master`.`id` having (`master`.`id` = (select max(`shots_master`.`id`) from `shots_master`)) limit 1);

-- 2015-10-25 23:18:32
